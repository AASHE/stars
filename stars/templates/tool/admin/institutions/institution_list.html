{% extends 'tool/admin/institutions/base.html' %}

{% block institution_content %}
     {% block subsubmenu %}
        <ul id='subsubmenu'>
            <li class='active'><a href='/tool/admin/list'>Manage STARS Institutions</a></li>
            <li><a href='/tool/admin/search'>Search AASHE Institutions</a></li>
        </ul>
    {% endblock %}
    <div class='help_note'> <span class='help_text'>
      <p>Lists most recently registered Submission for ALL institutions currently participating in STARS.</p>
      <ul>
        <li>Click institution name to <strong>Masquerade</strong>, and edit / view the insititutions STARS data.</li>
        <li>Click <img src='/media/static/images/money.png'> for payment processing for this institution.</li>
        <li>Enable or Disable institutions by checking/unchecking the box beside their name - be sure to 'Save' your changes.
            <ul>
                <li>(<font color='red'>*</font>) indicates a disabled institution.</li>
            </ul>
        </li>
      </ul>
    </span></div>
    {% load help %}
    {% load submit_tags %}
    {% load cache %}
	{% cache 86400 admin_institution_list %}
    <form method='POST' action='.'>
      <table id="institution-list" style='padding:10px;'>
        <tr><th colspan=3>Institution</th><th colspan=4>Latest Submission</th><th rowspan=2>Admin<br>Tools</th>
        <tr><th colspan=3 style="text-align:left">Enabled</th> <th>Version</th><th>Registered</th><th>Due</th><th>Progress</th></tr>
	    {% for f in form_list %}
          <tr{% cycle ' class="odd"' ''%}>
	        <td>
	            {{ forloop.counter }}
	        </td>
            <td> 
              {% for field in f.enable_form %}
                {{ field|safe }}
              {% endfor %}
            </td>
            <td>
              <a href='{{ f.ss.institution.get_masquerade_url }}'>{{ f.ss.institution }}</a>
                 {% if not f.ss.institution.enabled %}
                   <span title="This institution is not enabled!"><font color='red'>*</font></span>
                 {% endif %}
            </td>
            <td> ({{ f.ss.creditset }}) </td>
            <td> {{ f.ss.date_registered }} </td>
            <td> ({{ f.ss.submission_deadline }}) </td>
            <td>
            {% with pc=f.ss.get_percent_complete %}
				{% if pc %} 
				   {% show_progress_icon pc %}
				{% else %}
				  -
				{% endif %}
            {% endwith %}
            </td>
            <td align='center'>
              <a href='{{ f.ss.institution.get_admin_payments_url }}' title='Manage payments for this institution'>
              	{% for payment in f.ss.payment_set.all %}
                	{% show_payment_type_icon payment %}
                {% endfor %}
              </a>
            </td>
          </tr>
	    {% endfor %}
      </table>
      <button type='submit'>Save</button>
    </form>
    {% endcache %}
{% endblock %}