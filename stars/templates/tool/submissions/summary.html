{% extends "tool/submissions/columned_layout.html" %}

{% block crumbs %} 
    {{ block.super }}
    {% load submit_tags  %}
    {% show_submit_crumbs active_submission.creditset %}
{% endblock %}

{% block tool_content %}
    {% load submit_tags %}
    {% if active_submission %}
    
		<h1>Submission Summary: {{ user.current_inst }}</h1>
		<table class='statusTable' cellspacing='0'>
		    <tr>
		        <th>Status</th>
		        <th>
		        	Provisional Rating
		        	{% load help %}
                	{% show_help_context 'provisional_rating' %}
		        </th>
		        <th>Registered Date</th>
		        <th>Submission Deadline</th>
		    </tr><tr>
		        <td>{{ active_submission.get_status }}</td>
		        <td>{{ active_submission.get_STARS_rating }}</td>
		        <td>{{ active_submission.date_registered }}</td>
		        <td>
		        	{{ active_submission.submission_deadline }}
		        	{% if is_admin %}
		        		<br/>
		        		<a href='{{ active_submission.get_submit_url }}'>Submit for Rating</a>
		        	{% endif %}
	        	</td>
		    </tr>
		</table>
		{% for cat in category_submission_list %}
			<a name='ec_{{ cat.category.id }}'></a>
			<h2>
			    <span class='provScore'>
			        <div class='provScorePercent'>{{ cat.get_STARS_score|floatformat:2 }}%</div>
			        <span class='provScoreCaption'>Provisional Score</span>
			    </span>
			    {% show_progress_icon cat %}
			    <img src='/media/static/images/collapse_big.gif' alt='+' onclick='expandCollapse(this,false);' id='ec_{{ cat.category.id }}' class='collapseExpand'/>
			    {{ cat }}
			</h2>
			<div id='ec_{{ cat.category.id }}_target' class='progressSubcat'>
			{% for sub in cat.subcategorysubmission_set.all %}
				<a name='ec_{{ cat.category.id }}_{{ sub.subcategory.id }}'></a>
			    <h3>
			        <span class='provScore'>
			            <div class='provScorePercent'>{{ sub.get_claimed_score|floatformat:2 }} / {{ sub.get_available_points|floatformat:2 }}</div>
			            <span class='provScoreCaption'>Points Claimed</span>
			        </span>
			        {% show_progress_icon sub %}
			        <img
			        	src='/media/static/images/collapse_big.gif' alt='+'
			        	onclick='expandCollapse(this, false);'
			        	id='ec_{{ cat.category.id }}_{{ sub.subcategory.id }}' class='collapseExpand' />
			        {{ sub }}
			    </h3>
			    <div id='ec_{{ cat.category.id }}_{{ sub.subcategory.id }}_target'>
			        <div class='subcatDescription'>
			        	{% autoescape off %}{{ sub.subcategory.description }}{% endautoescape %}
			        </div>
			        <table class='greyTable'>
			            <tr>
			                <th>Credit</th>
			                <th>Status</th>
			                <th>Points Claimed</th>
			            </tr>
			            {% for c in sub.creditusersubmission_set.all %}
				            <tr class='{% cycle 'even' 'odd' %}' {% ifchanged c.credit.type %}style="border-top-width: 1px;"{% endifchanged %}>
				                <td class='credit'><a href='{{ c.credit.get_submit_url }}'>{{ c }}</a></td>
				                <td>{% show_status_icon c %}</td>
				                <td>{{ c.assessed_points|floatformat:2 }} / {% format_available_points c %}</td>
				            </tr>
			          	{% endfor %}
			        </table>
			    </div>
			    {% if not forloop.last %}
			    	<hr/>
			    {% endif %}
			{%endfor %}
			</div>
		{% endfor %}
    {% endif %}
{% endblock %}
