{% extends 'tool/manage/base.html' %}

{% load content %}
{% load aashe_rules_tags %}
{% load help %}

{% block crumbs-tool %}<li>Share Data</li>{% endblock %}

{% block tabs %}
	{% with active_tab="share" %}{{ block.super }}{% endwith %}
{% endblock %}

{% block institution_content %}
  {% display_block_content 'third-parties' user %}

    <form action='.' method='post'>
    {# @todo: Use the iteration tool available in Django 1.4 when it launches #}

    <table class='table'>
    	<thead>
        <tr>
            <th>Organization</th>
            <th>Next Deadline</th>
            <th>Grant Access?</th>
        </tr>
        </thead>
        <tbody>
        {% for tp in third_party_list %}
          <tr class="{% cycle 'even' 'odd' %}"  {% if tp.disabled %}style="color: #888;"{% endif %}>
            <td>
              {{ tp.name }}
              {% if tp.publication %}
                <br/>({{ tp.publication }})
              {% endif %}
            </td>
            <td>
              {% if tp.next_deadline %}
                {{ tp.next_deadline }}
              {% endif %}
            </td>
            <td>
              <input  type="checkbox"
                      name="third_parties"
                      value="{{ tp.id }}"
                      id="id_third_parties_{{ forloop.counter0 }}"
                      {% if tp.disabled %}
                        disabled="disabled"
                      {% else %}
                        {% if tp in institution.third_parties.all %}checked="checked"{% endif %}
                      {% endif %}
              />
              {% if tp.help_text %}{% show_help_text tp.help_text %}{% endif %}
            </td>
          </tr>
        {% endfor %}
        </tbody>
    </table>

	    <div class='form-actions'>
	          <button type='submit' id='submit_button' class='btn btn-primary'>Save</button>
	      </div>
    </form>

    <h3>Snapshots</h3>
    {% display_block_content 'third-party_snapshots' user %}
    <table class='table'>
    	<thead>
        <tr>
            <th>Date of Snapshot</th>
            <th>STARS Version</th>
        </tr>
        </thead>
        <tbody>
        {% if snapshot_list %}
          {% for ss in snapshot_list %}
            <tr>
              <td>
                {{ ss.date_submitted }}
              </td>
              <td>
                {{ ss.creditset.version }}
              </td>
            </tr>
          {% endfor %}
        {% else %}
        <tr>
          <td colspan="2">
            No current snapshots
          </td>
        </tr>
        {% endif %}
        </tbody>
    </table>
    <p align='center'>
      {% testrule institution_has_snapshot_feature institution %}
		<a href='{% url save-snapshot institution.slug institution.current_submission.id %}' class='btn btn'>
			<i class="icon-share-alt"></i> Take a Snapshot of Your Data Now</a>
      {% else %}
        <a href='{% url migrate-options institution.slug  %}' class='btn'>
        	<i class='icon-share-alt'></i> Migrate</a>
        	to the latest version of STARS to start taking snapshots.

      {% endtestrule %}
    </p>
{% endblock %}
