{% extends 'tool/manage/submissionset_base.html' %}

{% block institution_content %}
    <table class='greyTable'>
        <tr>
            <th>Credit Set</th>
            <th>Registered</th>
            <th>Due</th>
            <th>Status</th>
            <th>
                Active
                {% load help %}
                {% show_help_context 'active_set' %}
            </th>
            <th>Actions</th>
        </tr>
        {% for set in user.current_inst.submissionset_set.all %}
        <tr class='{% cycle 'odd' 'even' %}'>
            <td>
                {{ set.creditset }}<br/>
                {% if set.is_rated %}
                    <a href='{{ set.get_scorecard_url }}'>Report</a>
                    {% if user.is_staff %} | {% endif %}
                {% endif %}
                {% if user.is_staff %}
                    <a href='{{ set.get_manage_url }}'>Edit</a>
                {% endif %}
            </td>
            <td>{{ set.date_registered }}</td>
            <td>
            	{{ set.submission_deadline }}
            	<span style='font-size: .8em;'>
	            	{% if set.extensionrequest_set.all %}
	            		<br/>
	            		{% for e in set.extensionrequest_set.all %}
	            			<br/>
	            			extended on {{ e.date }}<br/>
	            			from {{ e.old_deadline }}<br/>
	            			by {{ e.user.email }}
	            		{% endfor %}
	            	{% endif %}
            	</span>
            </td>
            <td>
            	{% if not set.missed_deadline %}
	            	{% if set.is_enabled %}
	            		{{ set.get_status }}
	            	{% else %}
	            		<i>Pending Payment</i><br/>
	            		<a href='{{ set.get_manage_url }}pay/'>Pay Now</a>
	            	{% endif %}
	            {% else %}
	            	Deadline Expired
	            {% endif %}
            </td>
            <td>
                {% ifequal set active_set %}
                    <img src='/media/static/images/accept.png' alt='active' title='Active Submission'/>
                {% else %}
                    {% if user.can_admin %}
                        <a href='{{ set.get_manage_url }}activate/'>Make Active</a>
                    {% endif %}
                {% endifequal %}
            </td>
            <td style='text-align: left'>
                {% if is_admin and not set.missed_deadline %}
                	{% if set == active_set and not set.was_submitted and set.is_enabled %}
                		<a href='{{ set.get_submit_url }}' class='button'>Submit for Rating</a>
                        <a href='{{ set.get_manage_url }}boundary/' class='button'>Edit Boundary</a>
		                {% if set.can_apply_for_extension %}
		                    <a href='{{ set.get_manage_url }}extension/' class='button'>Extend Deadline</a>
		                {% endif %}
                	{% endif %}
                {% endif %}
            </td>
        </tr>
        {% endfor %}
        {% if user.is_staff %}
        <tr>
            <td colspan='10' style='text-align: center;border-top: 1px solid #aaa;'>
                {% if not user.current_inst.starsaccount_set.all %}
                    <p>You must <a href='/tool/manage/users/'>add</a> at least one user to this institution before you can create a submission set.</p>
                {% else %}
                    <a href='/tool/manage/submissionsets/add/'>Add</a>
                {% endif %}
            </td>
        </tr>
        {% endif %}
    </table>
    
    <p style='text-align: center; padding: 10px'>
    	<img src='/media/static/images/add.png' style='vertical-align: middle'/>
    	<a href='/tool/manage/submissionsets/purchase/'>Purchase another Submission Set</a>
    </p>
{% endblock %}
