{% extends 'tool/manage/base.html' %}

{% load content %}

{% block crumbs-tool %}<li>Users</li>{% endblock %}

{% block tabs %}
	{% with active_tab="users" %}{{ block.super }}{% endwith %}
{% endblock %}

{% block help_content %}
    {% display_block_content 'manage_accounts' user %}
{% endblock %}

{% block institution_content %}
    <form method='post' action='/tool/manage/users/add/'>
        <table class='table'>
        	<thead>
          <tr>
            <th>User's e-mail</th>
            <th>Role</th>
            <th></th>
            <th>Last Login</th>
          </tr>
          </thead>
          <tbody>
          {% for row in account_list %}
            {% if row.edit_form %}
              <tr>
                <td>
                     {{ row.account.user.email }}
                     {{ row.edit_form.email }}
                </td>
                <td>{{ row.edit_form.userlevel }}</td>
                <td class='buttonColumn'> <button type='submit' class='btn'>Save</button> </td>
                <td>
                  {{ notify_form.notify_users }}
                   <span class='help'>Notify user by e-mail of account changes.</span>
                </td>
              </tr>
            {% else %} 
              {% with row.account as account %}
              <tr class='{% cycle 'even' 'odd' %}{% if account.is_pending %} pending{% endif %}'  {% if account.is_pending %}title="Account pending - user must register at www.aashe.org."{% endif %}>
                <td>
                  {{ account.user.email }}
                  {% if account.is_pending %}
                    <span class="pending_note">*</span>
                  {% endif %}
                </td>
                <td>{{ account.get_user_level_display }}</td>
                <td class='buttonColumn'>
                    {% ifnotequal account.user user %}
                        <a href='{{ account.get_edit_url }}'>
                            <i class='icon-pencil'></i>
                        </a>
                        <a href='{{ account.get_delete_url }}'>
                            <i class='icon-trash'></i>
                        </a>
                    {% else %}
                        {% if user.is_staff %}
                          <a href='{{ account.get_delete_url }}'>
                              <i class='icon-trash'></i>
                          </a>
                        {% endif %}
                    {% endifnotequal %}
                </td>
                <td>
                  {% if account.last_access %}
                    {{ account.last_access|date:"D d M Y" }}
                  {% else %}
                    <span class="pending_note" title="User has not yet logged in to STARS">-</span>
                  {% endif %}
                </td>
              </tr>
              {% endwith %} 
            {% endif %}
          {% endfor %}
          <tr>
            <td>
                {{ new_account_form.email }}
            </td>
            <td>{{ new_account_form.userlevel }}</td>
            <td class='buttonColumn'>
              {% if editing %}
	            <a href='{{ account_list.0.account.get_manage_url }}'>
	              <i class='icon-pencil'></i>
	            </a>
              {% else %}
                <button type='submit' class='btn btn-primary'>Add</button>
              {% endif %}
            </td>
            <td>
              {% if not editing %}
                {{ notify_form.notify_users }}
                 <span class='help'>Notify user by e-mail of new account.</span>
              {% endif %}
            </td>
           </tr>
           </tbody>
         </table>
    </form>
{% endblock %}
