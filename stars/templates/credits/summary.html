{% extends 'credits/columned_layout.html' %}

{% block center_column %}
    {% load submit_tags %}
    <h1>{% block h1 %}{{ institution }}{% endblock %}</h1>
    {% block summaryTable %}{% endblock %}
    
    <div class="accordion" id="categories">
    	{% for cat in submissionset.categorysubmission_set.all %}
			<div class="accordion-group">
				<div class="accordion-heading category-accordion-heading">
					<a class="accordion-toggle" data-toggle="collapse" data-parent="#categories" href="#{{ cat.id }}">
						{% include "credits/category_heading.html" %}
	                </a>
	              </div>
	              <div id="{{ cat.id }}" class="accordion-body collapse in">
					<div class="accordion-inner">
						<div class="accordion subcategory_accordion" id="{{ cat.id }}_subcategories">
							{% for sub in cat.subcategorysubmission_set.all %}
								<div class="accordion-group collapse in">
									<div class="accordion-heading">
										<a class="accordion-toggle" data-toggle="collapse" data-parent="#{{ cat.id }}_subcategories" href="#{{ sub.id }}">
											{% include "credits/subcategory_heading.html" %}
										</a>
									</div>
									<div id="{{ sub.id }}" class="accordion-body collapse in">
										<div class="accordion-inner">
											{% block subcategory_description %}{% endblock %}
											{% include "credits/subcategory_content.html" %}
		                  				</div>
									</div>
		            			</div>
		            		{% endfor %}
						</div>
					</div>
				</div>
			</div>
		{% endfor %}
	</div>
    
    {% comment %}
    <div class="accordion" id="categories2">
    {% for cat in submissionset.categorysubmission_set.all %}
      {% block category_section %}
      	<div class="accordion-group">
	    	<div class="accordion-heading">
	        	<a class="accordion-toggle" data-toggle="collapse" data-parent="#categories" href="#ec_{{ cat.category.id }}">
	        		{% block category_summary_progress %}{% endblock %}
	        		<strong>{{ cat }}</strong>
	        	</a>
        			{% block category_summary_points %}
	                    {% ifnotequal cat.category.title 'Innovation' %}
	                        <div class='provScorePercent'>{{ cat.get_STARS_score|floatformat:2 }}%</div>
	                        <span class='provScoreCaption'>Provisional Score</span>
	                    {% else %}
	                        <div class='provScorePercent'>{{ cat.get_claimed_points|floatformat:2 }}</div>
	                        <span class='provScoreCaption'>Points Claimed</span>
	                    {% endifnotequal %}
	                {% endblock %}
        	</div>
        	
        	<div id="ec_{{ cat.category.id }}" class="accordion-body collapse in">
	        	<div class="accordion-inner">
	        	
	        		{% for sub in cat.subcategorysubmission_set.all %}
	                	
	                    <div class="accordion" id="accordion_{{ sub.subcategory.id }}">
			                <div class="accordion-group">
			                    <div class="accordion-heading">
			                        <a class="accordion-toggle" data-toggle="collapse" data-parent="#accordion_{{ sub.subcategory.id }}" href="#ec_{{ cat.category.id }}_{{ sub.subcategory.id }}">
			                            {{ sub }}
			                        </a>
			                        <div class='pull-right'>
							                {% testrule institution_has_score_feature user.current_inst %}
					                			<td>
								                    {% if cat.category.include_in_score %}
								    			        Points Claimed:<br/>
								    			        <strong>
								    			        	{{ sub.get_claimed_points|floatformat:2 }} /
								    			        	{{ sub.get_adjusted_available_points|floatformat:2 }}
								    			        </strong>
								                    {% endif %}
												</td>
								            {% endtestrule %}
					                </table>
			                    </div>
            					{% block subcategory_description %}{% endblock %}
            					<div id="ec_{{ cat.category.id }}_{{ sub.subcategory.id }}" class="accordion-body collapse in">
			                        <div class="accordion-inner">
						                <table class='table table-condensed table-striped'>
						                	<thead>
						                    <tr>
						                        {% block credit_summary_header %}
						                            <th>Credit</th>
						                            <th>Status</th>
						                            <th>Points</th>
						                        {% endblock %}
						                    </tr>
						                    </thead>
						                    <tbody>
						                    {% for c in sub.creditusersubmission_set.all %}
						                        <tr class='{% cycle 'even' 'odd' %}' {% ifchanged c.credit.type %}style="border-top-width: 1px;"{% endifchanged %}>
						                            {% block credit_summary_row %}
						                                <td class='credit'><a href='{{ c.credit.get_submit_url }}'>{{ c }}</a></td>
						                                <td>{% show_status_icon c %}</td>
						                                <td>{{ c.assessed_points|floatformat:2 }} / {% format_available_points c %}</td>
						                            {% endblock %}
						                        </tr>
						                    {% endfor %}
						                    </tbody>
						                </table>
						             </div>
							     </div>
							</div>
						</div>
					</div>
				</div>
			</div>
        {%endfor %}
        </div>
      {% endblock %}
    {% endfor %}
    </div>
    {% endcomment %}
{% endblock %}
