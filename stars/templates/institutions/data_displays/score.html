{% extends 'institutions/data_displays/base.html' %}

{% load thumbnail %}

{% block crumbs %}
	{{ block.super }} &gt;
	<a href='/institutions/data-displays/category-scores/'>Category Scores</a>
{% endblock %}

{% block title %}Category Scores | {{ block.super }}{% endblock %}

{% block body_onload %}{{ block.super }}initLookup();{% endblock %}

{% block extra_head %}
	{{ block.super }}
	<script type='text/javascript'>
		choices_lookup = {
			org_type: ['Two Year Institution', 'Four Year Institution', 'Graduate Institution', 'System Office'],
			rating: ['Bronze', 'Silver', 'Gold', 'Platinum']
		}
		
		function initLookup() {
			sel = document.getElementById('id_type');
			applyLookup(sel);
		}
		
		function deleteFilter(prefix) {
			document.getElementById("id_" + prefix + "-delete").value = "true";
			document.getElementById("filterForm").submit();
		}
		
		function applyLookup(obj) {
		
			sel = document.getElementById('id_item');
			while( sel.length > 1 ) {
				sel.remove(sel.length - 1)
			}
				
			if( obj.selectedIndex ) {
				key = obj.options[obj.selectedIndex].value
				for(i=0; i < choices_lookup[key].length; i++) {
					sel.add(new Option(choices_lookup[key][i], choices_lookup[key][i]));
				}
			}
		}
	</script>
	{% if object_list %}
	<script type="text/javascript" src="https://www.google.com/jsapi"></script>
    <script type="text/javascript">
      google.load("visualization", "1", {packages:["corechart"]});
      google.setOnLoadCallback(drawChart);
      function drawChart() {
        var data = new google.visualization.DataTable();
   
		  var raw_data = [
		  					{% for o in object_list %}
		  						[
		  							"{{ o.item }}",
		  							{% if o.total %}{{ o.ER_avg|floatformat:2 }}{% else %}0{% endif %},
		  							{% if o.total %}{{ o.OP_avg|floatformat:2 }}{% else %}0{% endif %},
		  							{% if o.total %}{{ o.PAE_avg|floatformat:2 }}{% else %}0{% endif %}
		  						]{% if not forloop.last %},{% endif %}
		  					{% endfor %}
		                 ];
		  
		  var categories = ["ER", "OP", "PAE"];
		                  
		  data.addColumn('string', 'Category');
		  for (var i = 0; i  < raw_data.length; ++i) {
		    data.addColumn('number', raw_data[i][0]);    
		  }
		  
		  data.addRows(categories.length);
		
		  for (var j = 0; j < categories.length; ++j) {    
		    data.setValue(j, 0, categories[j]);    
		  }
		  for (var i = 0; i  < raw_data.length; ++i) {
		    for (var j = 1; j  < raw_data[i].length; ++j) {
		      data.setValue(j-1, i+1, raw_data[i][j]);    
		    }
		  }

        var chart = new google.visualization.ColumnChart(document.getElementById('barChart'));
        chart.draw(data, {height: 220,
        					backgroundColor: "#eff5e6",
			                 colors: [
			                 	'#1b617f',
			                   '#858f38',
			                   "#8C745A",
			                   '#A39161',
			                   '#404040',
			                   '#9d9982',
			                 ],
                          hAxis: {title: 'Category',},
                          legend: 'top'
                         });
      }
    </script>
    {% endif %}
{% endblock %}

{% block content %}
	<div class='inner20'>
	<h1>Aggregated STARS Category Scores</h1>
	{% load content %}
    {% display_block_content 'data_display_categories' user %}
	<form method='POST' action='.' id='filterForm'>
		<div class='greyBox'>
			Display results for institutions with the following characteristics:<br/><br/>
			<table class='filterList'>
				<tr>
					<th></th>
					<th>Type of Characteristic</th>
					<th>Specific Characteristic</th>
					<th></th>
				</tr>
				{% for k, f in form.forms.delete_forms.forms.items %}
					<tr>
						<td style="text-align: center;">
							<img src='/media/static/images/delete_grey_x.png' alt='[x]' onclick="deleteFilter('{{ k }}');" style='cursor: pointer;' />
							{{ f.delete }}
							{{ f.errors }}
						</td>
						<td>{{ f.instance.type }}</td>
						<td>{{ f.instance.item }}</td>
						<td></td>
					</tr>
				{% endfor %}
				<tr>
					<td></td>
					<td>
						{{ form.forms.new_filter_form.type }}
						{{ form.forms.new_filter_form.errors.type }}
					</td>
					<td>
						{{ form.forms.new_filter_form.errors.item }}
						{{ form.forms.new_filter_form.item }}
					</td>
					<td><button type='submit'>Add Filter</button></td>
				</tr>
			</table>
		</div>
	</form>
	<div style='text-align: center'>
		<img src='/media/static/images/arrow_down.png' />
	</div>
	<table id='institution_list' class='greyTable'>
       	<tr>
       		<th style='text-align: left'>
       			Selected Characteristic
       		</th>
       		<th>ER</th>
       		<th>OP</th>
       		<th>PAE</th>
       		<th>IN</th>
       		<th>Total</th>
       	</tr>
       	{% if object_list %}
	       	{% for o in object_list %}
	       		<tr class="{% cycle 'even' 'odd' %}">
	       			<td style='text-align: left'>{{ o.title }}</td>
	       			<td>{% if o.total %}{{ o.ER_avg|floatformat:2 }}%{% else %}--{% endif %}</td>
	       			<td>{% if o.total %}{{ o.OP_avg|floatformat:2 }}%{% else %}--{% endif %}</td>
	       			<td>{% if o.total %}{{ o.PAE_avg|floatformat:2 }}%{% else %}--{% endif %}</td>
	       			<td>{% if o.total %}{{ o.IN_avg|floatformat:2 }}{% else %}--{% endif %}</td>
	       			<td>{{ o.total }}</td>
	       		</tr>
	       	{% endfor %}
	    {% else %}
       		<tr><td colspan="6">
       			<p style='padding: 30px;'>
       				No results yet. Please filter on a characteristic above.
       			</p>
       		</td></tr>
       	{% endif %}
	</table>
	{% if object_list %}
		<div style='text-align: center'>
			<img src='/media/static/images/arrow_down.png' />
		</div>
		<div style='margin: 10px;padding: 2px; border: 1px solid #aaa;'>
			<div id="barChart" style="height:220px;margin: 0px;"></div>
		</div>
	{% endif %}
	</div>
{% endblock %}